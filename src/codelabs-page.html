<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/codelab-components/google-codelab-elements.html">

<dom-module id="codelabs-page">

  <template>
    <style>
      :root {
        --google-codelab-header-background: var(--app-secondary-color);    
      }
      :host {
        display: block;
        height: 100vh;
      }

      ::content pre {
        color: var(--color-dark);
        background-color: var(--color-light);
        border: 1px solid var(--color-mid-light);
      }
      ::content pre .str, ::content code .str { color: #333; } /* string  - green */
      ::content pre .kwd, ::content code .kwd { color: #333; } /* keyword - dark pink */
      ::content pre .com, ::content code .com { color: #333; font-style: italic; } /* comment - gray */
      ::content pre .typ, ::content code .typ { color: #333; } /* type - light blue */
      ::content pre .lit, ::content code .lit { color: #333; } /* literal - blue */
      ::content pre .pun, ::content code .pun { color: #333; } /* punctuation - white */
      ::content pre .pln, ::content code .pln { color: #333; } /* plaintext - white */
      ::content pre .tag, ::content code .tag { color: #333; } /* html/xml tag    - light blue */
      ::content pre .atn, ::content code .atn { color: #333; } /* html/xml attribute name  - khaki */
      ::content pre .atv, ::content code .atv { color: #333; } /* html/xml attribute value - green */
      ::content pre .dec, ::content code .dec { color: #333; } /* decimal - blue */      
    </style>

    <app-route
      route="{{route}}"
      pattern="/:codelab"
      data="{{routeData}}"
      tail="{{routeTail}}"></app-route>

      <iron-pages id="codelabwrapper" role="main" selected="[[codelab]]" attr-for-selected="name">
      </iron-pages>

  </template>

  <script>

    Polymer({

      is: 'codelabs-page',

      properties: {

        codelab: {
          type: String,
          reflectToAttribute: true,
        },

        route: {
          type: String,
          reflectToAttribute: true,
        }

      },

      observers: [
        '_codelabChanged(routeData.codelab)'
      ],

      _codelabChanged: function(codelab) {
        // FIXME (if upstream solution)
        // as we data-bind "subroute", even when not active, the view in map
        // /events/events_id -> codelab_id matches :codelabs and return invalid content
        // escape if we are not current view
        this.codelab = codelab;
        // Skip loading page if nothing is selected
        if (this.codelab === undefined) {
          return;
        }
        // load codelab import on demand.
        var link = this.importHref(
          this.resolveUrl("/src/codelabs/" + codelab + '/index.ubuntu-template.html'),
          function() {
            if (link) {
              var dynamicEl = document.createElement(codelab);
              dynamicEl.setAttribute("name", codelab);
              dynamicEl.route = this.routeTail;
              Polymer.dom(this.$.codelabwrapper).appendChild(dynamicEl);
            }
          }, null, true);
      }

    });

  </script>

</dom-module>
